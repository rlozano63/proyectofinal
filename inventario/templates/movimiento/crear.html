{% extends 'AdminLTE/index.html' %}

{% block content %}
	<form method="post" id="form">
		{% csrf_token %}
		<input type="hidden" id="movimiento_pk">
		{{ form.as_p }}
	</form>

	<form method="post" id="form_detalle" @submit.prevent="movFormCreateAddDetalle">
		{% csrf_token %}
		{{ form_detalle.as_p }}
		<input type="submit" value="Guardar" />
	</form>

	<table class="table">
		<thead>
			<tr>
				<th> producto </th>
				<th> cantidad </th>
				<th> valor </th>
				<th> valor_total </th>
			</tr>
		</thead>
		<tbody>
			<tr v-for="producto in movimientos.forms.create.productos">
				<td> [[ producto.producto ]] </td>
				<td>
					<input v-model="producto.cantidad" @change="movFormCreateUpdateeVT(producto)" type="number"> </td>
				<td>
					<input v-model="producto.valor" @change="movFormCreateUpdateeVT(producto)" type="number"> </td>
				<td> [[ producto.valor_total ]] </td>
				<td>
					<button @click="movFormCreateDeleteProducto(producto)">Borrar</button>
				</td>
			</tr>
		</tbody>
	</table>
	<input type="button" value="Facturar" @click="movFormCreateFacturar" />


{% endblock content %}

{% block scripts %}
	<script type="text/javascript">
		$("#id_movimiento").closest("p").remove()
		/*

		$("#form").submit(function(event){
			var currentForm = $(this)
			event.preventDefault()

			var formData = new FormData(this);
			$('input[type=file]').each(function(i, file) {
				$.each(file.files, function(n, file) {
					formData.append('file-'+i, file);
				})
			})

			$.ajax({
				url: "/movimiento/crear/",
				type: 'POST',
				data:formData,
				cache:false,
				contentType: false,
				processData: false,
				error: function(response){
					$('<ul class="errorlist"></ul>')
					var data = JSON.parse(response.responseText)
					for (field in data.errors){
						var ul = $('<ul class="errorlist"></ul>')
						var selector = "[name=" + field + "]"
						for (var error of data.errors[field]){
							var message = alertBootstrap(error,"danger")
							ul.append($("<li>").append(message))
						}
						$(selector).closest(".form-group").find("ul.errorlist").remove()
						$(selector).closest(".form-group").prepend(ul)
					}
				},
				success: function(response){
					console.log(response)
					response.object = JSON.parse(response.object)[0]
					$("#movimiento_pk").val(response.object.pk)
				}

			});
		})
		$("#form_detalle").submit(function(event){
			var currentForm = $(this)
			event.preventDefault()

			var formData = new FormData(this);
			$('input[type=file]').each(function(i, file) {
				$.each(file.files, function(n, file) {
					formData.append('file-'+i, file);
				})
			})

			formData.append("movimiento",$("#movimiento_pk").val())

			$.ajax({
				url: "/movimiento/detalle/crear/",
				type: 'POST',
				data:formData,
				cache:false,
				contentType: false,
				processData: false,
				error: function(response){
					$('<ul class="errorlist"></ul>')
					var data = JSON.parse(response.responseText)
					for (field in data.errors){
						var ul = $('<ul class="errorlist"></ul>')
						var selector = "[name=" + field + "]"
						for (var error of data.errors[field]){
							var message = alertBootstrap(error,"danger")
							ul.append($("<li>").append(message))
						}
						$(selector).closest(".form-group").find("ul.errorlist").remove()
						$(selector).closest(".form-group").prepend(ul)
					}
				},
				success: function(response){
					console.log(response)
				}

			});
		})*/

	</script>
{% endblock scripts %}
